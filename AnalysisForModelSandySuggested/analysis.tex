\documentclass[letterpaper,11pt]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage[top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm]{geometry}
\usepackage{amsthm}

\newcommand{\var}{{\operatorname{var}}}
\newcommand{\cov}{{\operatorname{cov}}}
\newcommand{\cor}{{\operatorname{cor}}}
\newcommand{\E}{{\operatorname{E}}}
\newcommand{\mean}{{\operatorname{mean}}}
\newcommand{\Rp}{{\operatorname{Re}}}
\newcommand{\Ip}{{\operatorname{Im}}}

\newtheorem{theorem}{Theorem}[]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}

\begin{document}

\title{Analysis supporting the suggestion of Sandy Liebhold to improve our model, deer paper}
\author{Daniel Reuman}
\maketitle

\section{The model}\label{sec:model}

The model setup is similar to the models used in the supplementary information for 
\cite{Desharnais2018}, but in
contrast to their models, our model
considers more than two habitat patches and does not consider dispersal.
Some of our below sentences are copied with very little or no change in wording
from that reference.
Suppose population dynamics are given by
\begin{equation}
w_{i} = c_1 w_i(t-1)+ \cdots + c_n w_i(t-n)+q_0 \epsilon_{i}(t)+\cdots+q_{m}\epsilon_{i}(t-m),\label{eq:mainmodel}
\end{equation}
where $w_{i}(t)$ is the deviation of a population index $x_{i}(t)$ in
habitat patch $i$ ($i=1,\ldots,N$) at time $t$ from an equilibrium value $x_{i}^{*}$. 
The environmental noise process $\epsilon=(\epsilon_{1},\ldots,\epsilon_{N})$
is assumed to be a second-order stationary stochastic process with $\E(\epsilon_{i})=0$
for all $i$. Without loss of generality, $c_n \neq 0$ and $q_m \neq 0$. We also assume
the complex roots of the polynomial $1-c_1 z - c_2 - \cdots - c_n z^n=0$
have modulus greater than one. This assumption is a necessary and sufficient condition 
for stability of the equilibrium of the general model of which \ref{eq:mainmodel}
is a linearization [\citealp{Desharnais2018}, their supplementary information section 1.2] and also for the existence of a stationary
stochastic process that is a solution of \ref{eq:mainmodel} \citep{Desharnais2018,Brillinger2011}. 

Let $S_{\epsilon_{i}\epsilon_{i}}$
denote the power spectrum of the process $\epsilon_{i}$ and let $S_{\epsilon_{i}\epsilon_{j}}$
denote the cross spectrum of the processes $\epsilon_{i}$ and $\epsilon_{j}$
(so the cospectrum, denoted $C_{\epsilon_{i}\epsilon_{j}}$, is $\Rp(S_{\epsilon_{i}\epsilon_{j}})$, the real part). Analogously, let $S_{w_i w_i}$,
$S_{w_i w_j}$ and $C_{w_i w_j}=\Rp(S_{w_i w_j})$ be the spectrum, cross spectrum
and cospectrum of the population processes $w_i$ and $w_j$.

\section{Derivation of the main result}

Suppose we are interested in the variance (through time) of the
total population, $\var_t(\sum_i x_i(t)) = \var_t(\sum_i w_i(t))$,
and the extent to which this variance may be dominated by particular timescales.
We write $\var_t(\sum_i w_i(t))=\sum_{i,j} \cov_t(w_i(t),w_j(t))$,
and using spectral tools to decompose by timescale,
$S_{\text{tot}} = \sum_{i,j} C_{w_i w_j}$, where $S_{\text{tot}}$
is the power spectrum of $x_{\text{tot}} = \sum_i x_i(t)$. Note that
the power spectrum of $x_{\text{tot}}$ is equal to that of 
$w_{\text{tot}}=\sum_i w_i(t)$. 

\begin{proposition}
For all $i \neq j$, define the two-dimensional processes 
$w_{ij}=(w_i,w_j)$ and $\epsilon_{ij} = (\epsilon_{i},\epsilon_{j})$ and 
let $S_{w_{ij} w_{ij}}$ and $S_{\epsilon_{ij}\epsilon_{ij}}$ be the spectral
matrices of those processes. Then
$S_{w_{ij} w_{ij}} = \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{ij}\epsilon_{ij}}$, where $\gamma=q_{ 0}+q_{ 1}\mu+\cdots+q_{m}\mu^{m}$,
$\lambda=c_{ 1 }\mu+c_{ 2}\mu^{2}+\cdots+c_{n}\mu^{n}$ and $\mu=\exp(-2\pi i f)$
for $f$ representing frequency, in cycles per time step. In particular,
$S_{w_i w_i} = \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{i}\epsilon_{i}}$ 
and $C_{w_i w_j} = \left| \frac{\gamma}{1-\lambda} \right|^2 C_{\epsilon_{i}\epsilon_{j}}$.
\label{prop:mainprop}
\end{proposition}

\begin{proof}
Consider the two-dimensional model
\begin{equation}
w_{k}(t) =c_{ 1}w_{k}(t- 1)+\cdots+c_{n}w_{k}(t-n)+q_{  0}\epsilon_{k}(t)  +\cdots+q_{m}\epsilon_{k}(t-m)
\end{equation}
for $k=i,j$. We rewrite this as
\begin{equation}
\mathcal{C} w_{ij} = \mathcal{Q} \epsilon_{ij} \label{eq:linfiltmod}
\end{equation}
for the linear filters
\begin{align}
\mathcal{C} &= I-c_1 IB - c_2 IB^2 - \cdots - c_n IB^n \\
\mathcal{Q} &= q_0 I + q_1 IB + \cdots + q_m IB^m,
\end{align}
where $I$ is the $2 \times 2$ identity matrix. 
Here $B$ is the backshift operator,
$B^{l}\delta(t)=\delta(t-l)$, for a stochastic process $\delta(t)$.
See \cite{Brillinger2011}, \cite{Reinsel1997} and \cite{Shumway2000}
for background on linear filters. Computing the spectral matrices of both
sides of \ref{eq:linfiltmod} gives
\begin{equation}
T(\mathcal{C}) S_{w_{ij}w_{ij}} \overline{T(\mathcal{C})} = T(\mathcal{Q}) S_{\epsilon_{ij}\epsilon_{ij}}
\overline{T(\mathcal{Q})}
\end{equation}
where $T(\mathcal{C})$ and $T(\mathcal{Q})$ 
are the transfer function matrices of the linear filters
$\mathcal{C}$ and $\mathcal{Q}$, respectively (see, for instance,
section 1.1.3 of \citealp{Reinsel1997}). But 
$T(\mathcal{C}) = (1-\lambda)I$ and $T(\mathcal{Q})=\gamma I$
(section 1.1.3 of \citealp{Reinsel1997}), so
\begin{align}
S_{w_{ij}w_{ij}} &= (1-\lambda)^{-1} I \gamma I S_{\epsilon_{ij}\epsilon_{ij}} \overline{\gamma} I (1-\overline{\lambda})^{-1}I \\
&= \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{ij}\epsilon_{ij}}.
\end{align}
$S_{w_{ij}w_{ij}}$ and $S_{\epsilon_{ij}\epsilon_{ij}}$ are $2 \times 2$ matrices, and considering the components and their real parts gives the last two statements of
the proposition.
\end{proof}

Now by applying proposition \ref{prop:mainprop}, we have
\begin{proposition}
Using the same notation as above,
$S_{\text{tot}} = \left| \frac{\gamma}{1-\lambda} \right|^{ 2} \left[ \sum_i S_{\epsilon_{i}\epsilon_{i}} +\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}\right]$.
\label{prop:mainprop2}
\end{proposition}
\begin{proof}
\begin{align}
S_{\text{tot}} &= \sum_{i,j} C_{w_i w_j} \\
&= \sum_{i,j} \left| \frac{\gamma}{1-\lambda} \right|^{ 2} C_{\epsilon_{i}\epsilon_{j}} \\
&= \left| \frac{\gamma}{1-\lambda} \right|^{ 2} \left[ \sum_i S_{\epsilon_{i}\epsilon_{i}} +\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}\right].\label{eq:splitup}
\end{align}
The second equality follows from proposition \ref{prop:mainprop}.
\end{proof}

Thus the power spectrum of the total  population is influenced by three terms.
First, $\left| \frac{\gamma}{1-\lambda} \right|^{ 2}$, which reflects
dynamics intrinsic to the population ($\gamma$ and $\lambda$ contain
the coefficients $c_1,\ldots,c_n$ and $q_0,\ldots,q_m$). Second,
$\sum_i S_{\epsilon_{i}\epsilon_{i}}$, the  sum of the power
spectra of the noise time series, which reflects the extent to which the noise
itself may be periodic. And third, $\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}$,
the sum of the cospectra of the noise, which reflects the extent to which noise
synchrony across locations may be specific to certain timescales.
These three terms can be independently manipulated in the model, with some
constraints. Note that because the first sum in the expression 
\ref{eq:finalres} is of $N$ quantities and the
second is of $N^2 - N$ quantities, results 
suggest that, when $N$ is large, timescale specificity of
synchrony of noise across locations will tend to be more important than
the nature of the periodicity of the noise.

\section{Example 1}\label{sect:example1}

For this model setup there were 10 sampling locations, and environmental noise $\epsilon_i(t)$
($i=1,\ldots,10$) was generated
(see section \ref{sec:noise1}) so that the power spectrum of noise at each location was 
$S_{\epsilon_i \epsilon_i} = \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2$ and
the cross spectrum between any two locations was 
$S_{\epsilon_i \epsilon_j}=\rho \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2$, for $c_1=0$ and $c_2=-1/9$. The noise synchrony parameter, $\rho$, was taken to be 
$0.8$ in one set of simulations and $0$ in another. For $\rho=0.8$, 
noise spectra, cospectra, and quadspectra are in figure \ref{fig:example1_noise_spectra_rho0p8}. 
For $\rho=0$ they are in figure \ref{fig:example1_noise_spectra_rho0}.
The semiperiodic nature of the noise
is revealed by the peak in the spectrum.
The only difference between the two simulations is the synchrony of the 
environmental noise which operates, as reflected in the noise cospectra.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_NoiseSpectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseCospectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseQuadspectra.pdf}
\caption{(A) Spectrum of the environmental noise at location 1 (same as the spectrum at any other of the 10 locations) for example 1, $\rho=0.8$. The solid red line is the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value. Similar setup for
 the other panels except cospectra (B) and quadspectra (C) of sites 1 and 2 are shown. }\label{fig:example1_noise_spectra_rho0p8}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_NoiseSpectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseCospectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseQuadspectra_rho0.pdf}
\caption{Similar to figure \ref{fig:example1_noise_spectra_rho0p8}, but using $\rho=0$.}\label{fig:example1_noise_spectra_rho0}
\end{figure}

The noise was used to drive the AR(1) model $w_i(t)=\rho_p w_i(t-1)+\epsilon_i(t)$
for $i=1,\ldots,10$. Here $\rho_p$ is a lag-1 autocorrelation parameter for the model;
the value $\rho_p=0.15$ was used. Proposition \ref{prop:mainprop} implies
that the spectrum of the population at each sampling location is
$S_{w_i w_i} = \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2
\left| \frac{1}{1-\rho_p \mu} \right|^2$ and the cross spectrum of the populations
at any two distinct sampling locations is 
$S_{w_i w_j} = \rho \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2 
\left| \frac{1}{1-\rho_p \mu} \right|^2$.
For $\rho=0.8$,
population spectra, cospectra, and quadspectra are in figure \ref{fig:example1_pops_spectra_rho0p8}.
For $\rho=0$ they are in figure \ref{fig:example1_pops_spectra_rho0}.
Again the only difference is that synchrony, revealed in the cospectrum,
is present and depends on timescale for $\rho=0.8$, but is absent for 
$\rho=0$.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_PopsSpectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsCospectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsQuadspectra.pdf}
\caption{(A) Spectrum of the population at location 1 (same as the spectrum at any other of the 10 locations) for example 1, $\rho=0.8$. The solid red line is the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value. Similar setup for
 the other panels except cospectra (B) and quadspectra (C) of sites 1 and 2 are shown. }\label{fig:example1_pops_spectra_rho0p8}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_PopsSpectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsCospectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsQuadspectra_rho0.pdf}
\caption{Similar to figure \ref{fig:example1_pops_spectra_rho0p8}, but using $\rho=0$.}\label{fig:example1_pops_spectra_rho0}
\end{figure}

Using proposition \ref{prop:mainprop2}, $S_{\text{tot}} = 
\left[N + (N^2-N)\rho \right] \left| \frac{1}{1-c_1 \mu - c_2 \mu^2} \right|^2  
\left| \frac{1}{1-\rho_p \mu} \right|^2$. This is plotted on figure
\ref{fig:Stotexample1}. The striking difference between the values of 
$S_{\text{tot}}$ for $\rho=0.8$ and $\rho=0$ is solely due to 
differences in synchrony. Periodicity (revealed here through the spectral peak for
$\rho=0.8$) is made much more noticeable via the synchrony. Example
stretches of the total population time series for the $\rho=0.8$ and 
$\rho=0$ cases (figure \ref{fig:totpopstretches}) show much
more noticeable semiperiodic fluctuations for $\rho=0.8$ than for 
$\rho=0$. A bit of measurement error would probably obscure the smaller fluctuations,
but not the larger ones.

\begin{figure}
\includegraphics[width=.8\textwidth]{Examp12_TotpopsSpectra.pdf}
\caption{The spectrum of the total population for example 1, $\rho=0.8$ (upper lines) and $\rho=0.15$ (lower lines). The solid red lines are the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red lines are medians, and 
agree closely with the analytic values. The difference between the upper and lines is solely due to synchrony.}\label{fig:Stotexample1}
\end{figure}

\begin{figure}
\includegraphics[width=.45\textwidth]{Examp1_Totpops.pdf}
\includegraphics[width=.45\textwidth]{Examp1_TotpopsMinusMA.pdf}
\caption{(A) Total population time series for the $\rho=0.8$ (black) and
$\rho=0$ (green) cases. (B) After removal of a $7$-year moving average,
to remove the red shift of populations, isolating the semiperiodic dynamics.
The semiperiodic dynamics are much more noticable for $\rho=0.8$, and would
be much less likely to be obscured by measurement error or other purely local
factors.}
\label{fig:totpopstretches}
\end{figure}

This example is informative, but it is not entirely satisfactory for our goals.
The basic problem is that the spectrum of the total population has the same shape
for $\rho=0.8$ and for $\rho=0$; it has just been multiplied by a large constant 
for the $\rho=0.8$ case. There is nothing wrong with that, it is what it is, but it
is possible to do better, I think (see the next example).
 
\section{Example 2}


\section{Generation of noise for example 1}\label{sec:noise1}

Noise for example 1 was generated via an AR(2) process. Let 
$\delta(t) = (\delta_1(t),\ldots,\delta_N(t))$ be drawn, independently for 
each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho$ in the off diagonal and $1$
in the diagonal. Let $\epsilon_i(t)=c_1 \epsilon_i(t-1) + c_2 \epsilon_i(t-2)+\delta_i(t)$. Proposition \ref{prop:mainprop} provides the spectra
and cross spectra of the noise process $\epsilon$ which are stated in section
\ref{sect:example1}.

\section{Generation of noise for example 2}



\bibliographystyle{plainnat}
\bibliography{biblio.bib}

\end{document}

