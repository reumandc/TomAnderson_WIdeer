\documentclass[letterpaper,11pt]{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage[top=2.5cm, bottom=2.5cm, left=2.5cm, right=2.5cm]{geometry}
\usepackage{amsthm}

\newcommand{\var}{{\operatorname{var}}}
\newcommand{\cov}{{\operatorname{cov}}}
\newcommand{\cor}{{\operatorname{cor}}}
\newcommand{\E}{{\operatorname{E}}}
\newcommand{\mean}{{\operatorname{mean}}}
\newcommand{\Rp}{{\operatorname{Re}}}
\newcommand{\Ip}{{\operatorname{Im}}}

\newtheorem{theorem}{Theorem}[]
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}

\begin{document}

\title{Analysis supporting the suggestion of Sandy Liebhold to improve our model, deer paper}
\author{Daniel Reuman}
\maketitle

\section{The model}\label{sec:model}

The model setup is similar to the models used in the supplementary information for 
\cite{Desharnais2018}, but in
contrast to their models, our model
considers more than two habitat patches and does not consider dispersal.
Some of our below sentences are copied with very little or no change in wording
from that reference.
Suppose population dynamics are given by
\begin{equation}
w_{i} = c_1 w_i(t-1)+ \cdots + c_n w_i(t-n)+q_0 \epsilon_{i}(t)+\cdots+q_{m}\epsilon_{i}(t-m),\label{eq:mainmodel}
\end{equation}
where $w_{i}(t)$ is the deviation of a population index $x_{i}(t)$ in
habitat patch $i$ ($i=1,\ldots,N$) at time $t$ from an equilibrium value $x_{i}^{*}$. 
The environmental noise process $\epsilon=(\epsilon_{1},\ldots,\epsilon_{N})$
is assumed to be a second-order stationary stochastic process with $\E(\epsilon_{i})=0$
for all $i$. Without loss of generality, $c_n \neq 0$ and $q_m \neq 0$. We also assume
the complex roots of the polynomial $1-c_1 z - c_2 - \cdots - c_n z^n=0$
have modulus greater than one. This assumption is a necessary and sufficient condition 
for stability of the equilibrium of the general model of which \ref{eq:mainmodel}
is a linearization [\citealp{Desharnais2018}, their supplementary information section 1.2] and also for the existence of a stationary
stochastic process that is a solution of \ref{eq:mainmodel} \citep{Desharnais2018,Brillinger2011}. 

Let $S_{\epsilon_{i}\epsilon_{i}}$
denote the power spectrum of the process $\epsilon_{i}$ and let $S_{\epsilon_{i}\epsilon_{j}}$
denote the cross spectrum of the processes $\epsilon_{i}$ and $\epsilon_{j}$
(so the cospectrum, denoted $C_{\epsilon_{i}\epsilon_{j}}$, is $\Rp(S_{\epsilon_{i}\epsilon_{j}})$, the real part). Analogously, let $S_{w_i w_i}$,
$S_{w_i w_j}$ and $C_{w_i w_j}=\Rp(S_{w_i w_j})$ be the spectrum, cross spectrum
and cospectrum of the population processes $w_i$ and $w_j$.

\section{Derivation of the main result}

Suppose we are interested in the variance (through time) of the
total population, $\var_t(\sum_i x_i(t)) = \var_t(\sum_i w_i(t))$,
and the extent to which this variance may be dominated by particular timescales.
We write $\var_t(\sum_i w_i(t))=\sum_{i,j} \cov_t(w_i(t),w_j(t))$,
and using spectral tools to decompose by timescale,
$S_{\text{tot}} = \sum_{i,j} C_{w_i w_j}$, where $S_{\text{tot}}$
is the power spectrum of $x_{\text{tot}} = \sum_i x_i(t)$. Note that
the power spectrum of $x_{\text{tot}}$ is equal to that of 
$w_{\text{tot}}=\sum_i w_i(t)$. 

\begin{proposition}
For all $i \neq j$, define the two-dimensional processes 
$w_{ij}=(w_i,w_j)$ and $\epsilon_{ij} = (\epsilon_{i},\epsilon_{j})$ and 
let $S_{w_{ij} w_{ij}}$ and $S_{\epsilon_{ij}\epsilon_{ij}}$ be the spectral
matrices of those processes. Then
$S_{w_{ij} w_{ij}} = \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{ij}\epsilon_{ij}}$, where $\gamma=q_{ 0}+q_{ 1}\mu+\cdots+q_{m}\mu^{m}$,
$\lambda=c_{ 1 }\mu+c_{ 2}\mu^{2}+\cdots+c_{n}\mu^{n}$ and $\mu=\exp(-2\pi i f)$
for $f$ representing frequency, in cycles per time step. In particular,
$S_{w_i w_i} = \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{i}\epsilon_{i}}$ 
and $C_{w_i w_j} = \left| \frac{\gamma}{1-\lambda} \right|^2 C_{\epsilon_{i}\epsilon_{j}}$.
\label{prop:mainprop}
\end{proposition}

\begin{proof}
Consider the two-dimensional model
\begin{equation}
w_{k}(t) =c_{ 1}w_{k}(t- 1)+\cdots+c_{n}w_{k}(t-n)+q_{  0}\epsilon_{k}(t)  +\cdots+q_{m}\epsilon_{k}(t-m)
\end{equation}
for $k=i,j$. We rewrite this as
\begin{equation}
\mathcal{C} w_{ij} = \mathcal{Q} \epsilon_{ij} \label{eq:linfiltmod}
\end{equation}
for the linear filters
\begin{align}
\mathcal{C} &= I-c_1 IB - c_2 IB^2 - \cdots - c_n IB^n \\
\mathcal{Q} &= q_0 I + q_1 IB + \cdots + q_m IB^m,
\end{align}
where $I$ is the $2 \times 2$ identity matrix. 
Here $B$ is the backshift operator,
$B^{l}\delta(t)=\delta(t-l)$, for a stochastic process $\delta(t)$.
See \cite{Brillinger2011}, \cite{Reinsel1997} and \cite{Shumway2000}
for background on linear filters. Computing the spectral matrices of both
sides of \ref{eq:linfiltmod} gives
\begin{equation}
T(\mathcal{C}) S_{w_{ij}w_{ij}} \overline{T(\mathcal{C})} = T(\mathcal{Q}) S_{\epsilon_{ij}\epsilon_{ij}}
\overline{T(\mathcal{Q})}
\end{equation}
where $T(\mathcal{C})$ and $T(\mathcal{Q})$ 
are the transfer function matrices of the linear filters
$\mathcal{C}$ and $\mathcal{Q}$, respectively (see, for instance,
section 1.1.3 of \citealp{Reinsel1997}). But 
$T(\mathcal{C}) = (1-\lambda)I$ and $T(\mathcal{Q})=\gamma I$
(section 1.1.3 of \citealp{Reinsel1997}), so
\begin{align}
S_{w_{ij}w_{ij}} &= (1-\lambda)^{-1} I \gamma I S_{\epsilon_{ij}\epsilon_{ij}} \overline{\gamma} I (1-\overline{\lambda})^{-1}I \\
&= \left| \frac{\gamma}{1-\lambda} \right|^2 S_{\epsilon_{ij}\epsilon_{ij}}.
\end{align}
$S_{w_{ij}w_{ij}}$ and $S_{\epsilon_{ij}\epsilon_{ij}}$ are $2 \times 2$ matrices, and considering the components and their real parts gives the last two statements of
the proposition.
\end{proof}

Now by applying proposition \ref{prop:mainprop}, we have
\begin{proposition}
Using the same notation as above,
$S_{\text{tot}} = \left| \frac{\gamma}{1-\lambda} \right|^{ 2} \left[ \sum_i S_{\epsilon_{i}\epsilon_{i}} +\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}\right]$.
\label{prop:mainprop2}
\end{proposition}
\begin{proof}
\begin{align}
S_{\text{tot}} &= \sum_{i,j} C_{w_i w_j} \\
&= \sum_{i,j} \left| \frac{\gamma}{1-\lambda} \right|^{ 2} C_{\epsilon_{i}\epsilon_{j}} \\
&= \left| \frac{\gamma}{1-\lambda} \right|^{ 2} \left[ \sum_i S_{\epsilon_{i}\epsilon_{i}} +\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}\right].\label{eq:splitup}
\end{align}
The second equality follows from proposition \ref{prop:mainprop}.
\end{proof}

Thus the power spectrum of the total  population is influenced by three terms.
First, $\left| \frac{\gamma}{1-\lambda} \right|^{ 2}$, which reflects
dynamics intrinsic to the population ($\gamma$ and $\lambda$ contain
the coefficients $c_1,\ldots,c_n$ and $q_0,\ldots,q_m$). Second,
$\sum_i S_{\epsilon_{i}\epsilon_{i}}$, the  sum of the power
spectra of the noise time series, which reflects the extent to which the noise
itself may be periodic. And third, $\sum_{i \neq j} C_{\epsilon_{i}\epsilon_{j}}$,
the sum of the cospectra of the noise, which reflects the extent to which noise
synchrony across locations may be specific to certain timescales.
These three terms can be independently manipulated in the model, with some
constraints. Note that because the first sum in the expression 
\ref{eq:splitup} is of $N$ quantities and the
second is of $N^2 - N$ quantities, results 
suggest that, when $N$ is large, timescale specificity of
synchrony of noise across locations will tend to be more important than
the nature of the periodicity of the noise.

\section{Example 1}\label{sect:example1}

For this model setup there were 10 sampling locations, and environmental noise $\epsilon_i(t)$
($i=1,\ldots,10$) was generated
(see section \ref{sec:noise1}) so that the power spectrum of noise at each location was 
$S_{\epsilon_i \epsilon_i} = \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2$ and
the cross spectrum between any two locations was 
$S_{\epsilon_i \epsilon_j}=\rho \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2$, for $c_1=0$ and $c_2=-1/9$. The noise synchrony parameter, $\rho$, was taken to be 
$0.8$ in one set of simulations and $0$ in another. For $\rho=0.8$, 
noise spectra, cospectra, and quadrature spectra are in figure \ref{fig:example1_noise_spectra_rho0p8}. 
For $\rho=0$ they are in figure \ref{fig:example1_noise_spectra_rho0}.
The semiperiodic nature of the noise
is revealed by the peak in the spectrum.
The only difference between the two simulations is the synchrony of the 
environmental noise which operates, as reflected in the noise cospectra.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_NoiseSpectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseCospectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseQuadspectra.pdf}
\caption{(A) Spectrum of the environmental noise at location 1 (same as the spectrum at any other of the 10 locations) for example 1, $\rho=0.8$. The solid red line is the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value. Similar setup for
 the other panels except cospectra (B) and quadrature spectra (C) of sites 1 and 2 are shown. }\label{fig:example1_noise_spectra_rho0p8}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_NoiseSpectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseCospectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_NoiseQuadspectra_rho0.pdf}
\caption{Similar to figure \ref{fig:example1_noise_spectra_rho0p8}, but using $\rho=0$.}\label{fig:example1_noise_spectra_rho0}
\end{figure}

The noise was used to drive the AR(1) model $w_i(t)=\rho_p w_i(t-1)+\epsilon_i(t)$
for $i=1,\ldots,10$. Here $\rho_p$ is a lag-1 autocorrelation parameter for the model;
the value $\rho_p=0.15$ was used. Proposition \ref{prop:mainprop} implies
that the spectrum of the population at each sampling location is
$S_{w_i w_i} = \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2
\left| \frac{1}{1-\rho_p \mu} \right|^2$ and the cross spectrum of the populations
at any two distinct sampling locations is 
$S_{w_i w_j} = \rho \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2 
\left| \frac{1}{1-\rho_p \mu} \right|^2$.
For $\rho=0.8$,
population spectra, cospectra, and quadrature spectra are in figure \ref{fig:example1_pops_spectra_rho0p8}.
For $\rho=0$ they are in figure \ref{fig:example1_pops_spectra_rho0}.
Again the only difference is that synchrony, revealed in the cospectrum,
is present and depends on timescale for $\rho=0.8$, but is absent for 
$\rho=0$.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_PopsSpectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsCospectra.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsQuadspectra.pdf}
\caption{(A) Spectrum of the population at location 1 (same as the spectrum at any other of the 10 locations) for example 1, $\rho=0.8$. The solid red line is the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value. Similar setup for
 the other panels except cospectra (B) and quadrature spectra (C) of sites 1 and 2 are shown. }\label{fig:example1_pops_spectra_rho0p8}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp1_PopsSpectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsCospectra_rho0.pdf}
\includegraphics[width=.31\textwidth]{Examp1_PopsQuadspectra_rho0.pdf}
\caption{Similar to figure \ref{fig:example1_pops_spectra_rho0p8}, but using $\rho=0$.}\label{fig:example1_pops_spectra_rho0}
\end{figure}

Using proposition \ref{prop:mainprop2}, $S_{\text{tot}} = 
\left[N + (N^2-N)\rho \right] \left| \frac{1}{1-c_1 \mu - c_2 \mu^2} \right|^2  
\left| \frac{1}{1-\rho_p \mu} \right|^2$. This is plotted on figure
\ref{fig:Stotexample1}. The striking difference between the values of 
$S_{\text{tot}}$ for $\rho=0.8$ and $\rho=0$ is solely due to 
differences in synchrony. Periodicity (revealed here through the spectral peak for
$\rho=0.8$) is made much more noticeable via the synchrony. Example
stretches of the total population time series for the $\rho=0.8$ and 
$\rho=0$ cases (figure \ref{fig:totpopstretches}) show much
more noticeable semiperiodic fluctuations for $\rho=0.8$ than for 
$\rho=0$. A bit of measurement error would probably obscure the smaller fluctuations,
but not the larger ones.

\begin{figure}
\includegraphics[width=.8\textwidth]{Examp12_TotpopsSpectra.pdf}
\caption{The spectrum of the total population for example 1, $\rho=0.8$ (upper lines) and $\rho=0.15$ (lower lines). The solid red lines are the analytically calculated spectrum listed in the text, and the grey lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red lines are medians, and 
agree closely with the analytic values. The difference between the upper and lower lines is solely due to synchrony.}\label{fig:Stotexample1}
\end{figure}

\begin{figure}
\includegraphics[width=.45\textwidth]{Examp1_Totpops.pdf}
\includegraphics[width=.45\textwidth]{Examp1_TotpopsMinusMA.pdf}
\caption{(A) Total population time series for the $\rho=0.8$ (black) and
$\rho=0$ (green) cases. (B) After removal of a $7$-year moving average,
to remove the red shift of populations, isolating the semiperiodic dynamics.
The semiperiodic dynamics are much more noticable for $\rho=0.8$, and would
be much less likely to be obscured by measurement error or other purely local
factors.}
\label{fig:totpopstretches}
\end{figure}

This example is informative, but it is not entirely satisfactory for our goals.
The basic problem is that the spectrum of the total population has the same shape
for $\rho=0.8$ and for $\rho=0$; it has just been multiplied by a large constant 
for the $\rho=0.8$ case. There is nothing wrong with that, it is what it is, but it
is possible to do better, I think (see the next example).
 
\section{Example 2}

For this model setup there were again $10$ sampling locations, and environmental noise
$\epsilon_{i}(t)$ ($i=1,\ldots, 10$) was generated (see section \ref{sec:noise2})
so that the power spectrum of noise at each location was 
$S_{\epsilon_{i}\epsilon_{i}} = \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^{ 2}+1$
and the cross spectrum between any two locations was
$S_{\epsilon_{i}\epsilon_{j}}= \rho_{1}\left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^{ 2}+\rho_2$, again using $c_1=0$ and $c_2=-4/9$. In our first set of simulations,
the noise synchrony parameters $\rho_1$ and $\rho_2$ were set to be,
respectively, $0$ and $0.8$. Thus synchrony was  not timescale specific
in this first simulation (cospectra were flat, equal to $\rho_2=0.8$). 
Note that $\rho_1$ and $\rho_2$
do not influence  the spectrum of the environmental noise  at each location,
they are synchrony parameters,  only controlling synchrony 
of environmental noise between locations. In our second set of simulations,
$\rho_2=0$, and $\rho_1$ was chosen so that covariances between locations
were the same, in expectation, as what they were in the first set of simulations.
Because the expected covariance between environmental noise time series at
locations $i$ and $j$ can be obtained from the cospectrum $S_{\epsilon_{i}\epsilon_{j}}$
via integration, $\int_{-1/2}^{1/2} S_{\epsilon_{i}\epsilon_{j}}(f) df$, 
where $f$ is frequency, this was accomplished by choosing $\rho_1$
so that $\int_{-1/2}^{1/2} \rho_1 \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2 df
= \int_{-1/2}^{1/2} 0.8 df = 0.8$. Thus, for the second set of simulations,
$\rho_1 = \frac{0.8}{\int_{-1/2}^{1/2} \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2 df}$. This was calculated numerically, and equals approximately $0.64$.
Thus synchrony was timescale specific in the second set of simulations.
Noise spectra, cospectra and quadrature spectra for the two simulation cases
are shown in figures \ref{fig:example2_noise_spectra_cs1} and \ref{fig:example2_noise_spectra_cs2}.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp2_NoiseSpectra_cs1.pdf}
\includegraphics[width=.31\textwidth]{Examp2_NoiseCospectra_cs1.pdf}
\includegraphics[width=.31\textwidth]{Examp2_NoiseQuadspectra_cs1.pdf}
\caption{(A) Spectrum of environmental noise at location 1 (same as the spectrum at any other of the 10 locations) for example 2, simulation case 1 described in the text. The solid red line is the analytically calculated spectrum listed in the text, and the gray lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value. Similar set up for the other panels except cospectra (B) and quadrature spectra (C) of sites 1 and 2 are shown.}\label{fig:example2_noise_spectra_cs1}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp2_NoiseSpectra_cs2.pdf}
\includegraphics[width=.31\textwidth]{Examp2_NoiseCospectra_cs2.pdf}
\includegraphics[width=.31\textwidth]{Examp2_NoiseQuadspectra_cs2.pdf}
\caption{Similar to figure \ref{fig:example2_noise_spectra_cs1}, but using simulation case 2 of example 2, described in the text.}\label{fig:example2_noise_spectra_cs2}
\end{figure}

The noise was used to drive the same AR(1) model as was used in example 1,
again using the parameter value $\rho_p=0.15$. Proposition \ref{prop:mainprop2}
implies that 
\begin{equation}
S_{\text{tot}}=\left| \frac{1}{1-\rho_p \mu} \right|^2
\left[ (N^2-N) \left[ \rho_1 \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2+\rho_2 \right] + N\left[ \left| \frac{1}{1-c_1 \mu-c_2 \mu^2} \right|^2+1 \right] \right].
\label{eq:example2Stotcs1}
\end{equation}
In simulation case 1, this is
$$S_{\text{tot}}^{(\text{case 1})}=\left| \frac{1}{1-\rho_p \mu} \right|^2
\left[ [(N^2-N)\rho_2 +N] + \left[ N \left| \frac{1}{1-c_1 \mu -c_2 \mu^2} \right|^2 \right] \right].$$
The first summand in the brackets is flat, and the second is peaked, as functions of 
frequency. The first
should dominate, because
$N^2 \gg N$ for large enough $N$. Thus the total population spectrum should be unpeaked for simulation case 1 (i.e., no semiperiodicity in the total population).
In simulation case 2, equation \ref{eq:example2Stotcs1} becomes
$$S_{\text{tot}}^{(\text{case 2})}=\left| \frac{1}{1-\rho_p \mu} \right|^2
\left[ \left[ ((N^2-N)\rho_1+N)\left| \frac{1}{1-c_1\mu-c_2\mu^2} \right|^2 \right]  +N \right].$$ The first summand in the brackets is peaked, and the second is flat,
as functions of frequency. The first should dominate because $N^2 \gg N$ for large N.
Thus the total population spectrum should be peaked for simulation case 2 
(semiperiodicity in the total population). Total-population spectra are shown in 
figure \ref{fig:example2_totpopspec} for the two simulation cases and time series
are in figure \ref{fig:example2_popts}; the statements made above are borne out by the figures. Essentially, it is not whether environmental noise time series are
semiperiodic that determines whether total population time series are semiperiodic.
Instead, when total populations are computed by summing a large number of local
populations (10 was enough in these examples), what matters much more is whether
the periodic components of noise are synchronous across sampling locations.

\begin{figure}
\includegraphics[width=.5\textwidth]{Examp2_TotpopsSpectra_cs1.pdf}
\includegraphics[width=.5\textwidth]{Examp2_TotpopsSpectra_cs2.pdf}
\caption{The spectrum of the total population for example 2, simulation case 1 (A) and simulation case 2 (B). The solid red lines are the analytically calculated spectra listed in the text, and the gray lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red lines are medians, and agree closely with the analytic values. The difference between (A) and (B) is solely due to whether the periodic or non-periodic component of the environmental noise is the synchronous component.}\label{fig:example2_totpopspec}
\end{figure}

\begin{figure}
\includegraphics[width=.45\textwidth]{Examp2_Totpops.pdf}
\includegraphics[width=.45\textwidth]{Examp2_TotpopsMinusMA.pdf}
\caption{(A) Total population time series for simulation case 1 (black) and simulation case 2 (green lines). (B) After removal of a 7-year moving average, to remove the red
shift of the populations, isolating the semiperiodic dynamics. The semiperiodic dynamics
are more noticable for case 2 (green lines). }\label{fig:example2_popts}
\end{figure}

\section{Example 3}\label{sec:example3}

For this model setup there were again $10$ sampling locations, and environmental
noise $\epsilon_i(t)$ ($i=1,\ldots,N$) was generated (see section \ref{sec:noise3})
so that the power spectrum of noise at each location was 
$S_{\epsilon_i \epsilon_i} = \left| \frac{1}{1-c_1^{(1)} \mu -c_2^{(1)} \mu^2} \right|^2+
\left| \frac{1}{1-c_1^{(2)} \mu -c_2^{(2)} \mu^2} \right|^2$ and the cross spectrum between any two locations was $S_{\epsilon_i \epsilon_j} = \rho^{(1)} \left| \frac{1}{1-c_1^{(1)} \mu -c_2^{(1)} \mu^2} \right|^2+
\rho^{(2)} \left| \frac{1}{1-c_1^{(2)} \mu -c_2^{(2)} \mu^2} \right|^2$.
We used $c_1^{(1)}=2/3$, $c_2^{(1)}=-4/9$, $c_1^{(2)}=-2/3$, $c_2^{(2)}=-4/9$.
These values make the functions of frequency $\left| \frac{1}{1-c_1^{(1)} \mu -c_2^{(1)} \mu^2} \right|^2$ and $\left| \frac{1}{1-c_1^{(2)} \mu -c_2^{(2)} \mu^2} \right|^2$
have peaks at, respectively, $f=1/6$ and $2/6$ cycles per sampling interval.
In our first set of simulations, we used $\rho^{(1)}=0.8$ and $\rho^{(2)}=0$,
and in our second set of simulations we used $\rho^{(1)}=0$ and $\rho^{(2)}=0.8$.
Essentially, noise was a sum of two semiperiodic processes in all locations, with 
periods 6 and 3 years. In simulation case 1, the period-6 process was 
synchronous across sampling locations and the period-3 process was asynchronous; 
simulation case 2 was set up in the reverse way. Note that the parameters
$\rho^{(1)}$ and $\rho^{(2)}$ do not influence the noise spectra; they are synchrony
parameters, influencing only cospectra between noises in different sampling 
locations. It is straightforward to show by computing integrals of 
cospectra that expected covariance between noise time series in different locations
was the same for cases 1 and 2. Noise spectra, cospectra and quadrature spectra
for the two simulation cases are in figures \ref{fig:example3_noise_spectra_cs1} and
\ref{fig:example3_noise_spectra_cs2}.

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp3_NoiseSpectra_cs1.pdf}
\includegraphics[width=.31\textwidth]{Examp3_NoiseCospectra_cs1.pdf}
\includegraphics[width=.31\textwidth]{Examp3_NoiseQuadspectra_cs1.pdf}
\caption{(A) Spectrum of environmental noise at location 1 (same as the spectrum at any other of the 10 locations) for example 3, simulation case 1 described in the text. The solid red line is the analytically calculated spectrum listed in the text, and the gray lines are estimated spectra for simulations of length 1024 (100 simulations performed and showed). The dashed red line is the median of the simulation spectra, and agrees closely with the analytic value, except for deviations at the peaks and troughs of the spectra which are due to biases in the spectrum estimator used. Similar set up for the other panels except cospectra (B) and quadrature spectra (C) of sites 1 and 2 are shown.}\label{fig:example3_noise_spectra_cs1}
\end{figure}

\begin{figure}
\includegraphics[width=.31\textwidth]{Examp3_NoiseSpectra_cs2.pdf}
\includegraphics[width=.31\textwidth]{Examp3_NoiseCospectra_cs2.pdf}
\includegraphics[width=.31\textwidth]{Examp3_NoiseQuadspectra_cs2.pdf}
\caption{Similar to figure \ref{fig:example3_noise_spectra_cs1}, But using simulation case 2 of example 3, described in the text.}\label{fig:example3_noise_spectra_cs2}
\end{figure}

The noise was used to drive the same AR(1) model as was used in prior examples,
again using the parameter value $\rho_p=0.15$. Proposition \ref{prop:mainprop2}
implies that
\begin{align}
S_{\text{tot}} &= \left| \frac{1}{1-\rho_p \mu} \right|^2
N\left[ \left| \frac{1}{1-c_1^{(1)}\mu-c_2^{(1)}\mu^2} \right|^2 
+ \left| \frac{1}{1-c_1^{(2)}\mu-c_2^{(2)}\mu^2} \right|^2\right] \\
&+ \left| \frac{1}{1-\rho_p \mu} \right|^2
(N^2-N)\left[ \rho^{(1)} \left| \frac{1}{1-c_1^{(1)}\mu-c_2^{(1)}\mu^2} \right|^2+ \rho^{(2)}\left| \frac{1}{1-c_1^{(2)}\mu-c_2^{(2)}\mu^2} \right|^2 \right].
\end{align}
The first summand is spectral power of the total population which is due to spectral power of the  environmental noise. The second summand is spectral power of the total population which is due to  synchrony of the environmental noise. The second summand will tend to be much more important  for large $N$ because then $N^2 \gg N$. The relative values 
of $\rho^{(1)}$ and $\rho^{(2)}$ determine the peakedness of this dominant
term in the total population power spectrum expression. Thus in simulation case 1 
one expects a peak in the total population power spectrum at period 6,
and in simulation case 2, one expects a peak in the total population power spectrum 
at period 3. Total-population spectra are shown in figure \ref{fig:example3_totpopspec} for the two simulation cases and time series are in figure \ref{fig:example3_popts}. Again, it is not whether environmental noise time series are semiperiodic that determines whether and how total population time series are semiperiodic. Instead, what matters is  whether a given periodic component of noise is synchronous across sampling locations.

\begin{figure}
\includegraphics[width=.5\textwidth]{Examp3_TotpopsSpectra_cs1.pdf}
\includegraphics[width=.5\textwidth]{Examp3_TotpopsSpectra_cs2.pdf}
\caption{The spectrum of the total population for example 3, simulation case 1 (A) and simulation case 2 (B). The solid red lines are the analytically calculated spectra listed in the text, and the gray lines are estimated spectra for simulations of length 1024 (100 simulations performed and shown). The dashed red lines are medians, and agree closely with the analytic values (except for deviations due to biases in estimation procedures, as explained previously). The difference between (A) and (B) is solely due to which periodic component of the environmental noise is the synchronous component.}\label{fig:example3_totpopspec}
\end{figure}

\begin{figure}
\includegraphics[width=.45\textwidth]{Examp3_Totpops.pdf}
\includegraphics[width=.45\textwidth]{Examp3_TotpopsMinusMA.pdf}
\caption{(A) Total population time series for simulation case 1 (black) and simulation case 2 (green lines). (B) After removal of a 7-year moving average, to remove the red
shift of the populations, isolating the semiperiodic dynamics. Dynamics clearly have different periods in the two cases. }\label{fig:example3_popts}
\end{figure}

\section{Example 4}

Dan, do one more example where the noise is the sum of two processes. The
first process is a sine wave in all locations, random phase. In cases 1 and 2 these have
the same phases in all locations (but different periods in the two cases, the same
period, of course, across locations). In case 3, random phases across locations and
the same period (and the same period as one of cases 1 and 2. This should be, 
formally, a stationary stochastic process for all cases. The second process 
is white noise with covariance matrix 1s on the diag and rho in the off diag.
This is much like the current fig. in the paper. But you should be able to
1) pipe this noise through an AR(1) process in the same way as the above examples, and
2) apply your theory to it, formally. 

\section{Thoughts on what goes in the paper}

After working out example 4, we could adapt the current fig 1 to fit that example (it's close already, just make it fit exactly), perhaps adding a new column showing the environmental noise. You explain the pop model, and you explain in the text what the noise model is, using words, but no formulas for it. You maybe have a short theory section. At the end of the theory section you explain this idea is actually quite general, and say there are theorems and several additional examples in the sup mat. And then you put all that stuff there in the sup mat. Maybe give a few sentences of explanation in the main
text boiling down the generality of the theory, or what it says, in plainer language than is in the sup mat. Probably don't have any math formulas in the main text, because we don't really even want to explain spectra in the main text. The main text is for wavelets, the sup mat has the spectral stuff because we can do the math for it.

\section{Generation of noise for example 1}\label{sec:noise1}

Noise for example 1 was generated via an AR(2) process. Let 
$\delta(t) = (\delta_1(t),\ldots,\delta_N(t))$ be drawn, independently for 
each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho$ in the off diagonal and $1$
in the diagonal. Let $\epsilon_i(t)=c_1 \epsilon_i(t-1) + c_2 \epsilon_i(t-2)+\delta_i(t)$. Proposition \ref{prop:mainprop} provides the spectra
and cross spectra of the noise process $\epsilon$ which are stated in section
\ref{sect:example1}.

\section{Generation of noise for example 2}\label{sec:noise2}

Noise for example 2 was the sum of two processes. The first process was an 
AR(2) process. Let $\delta^{(1)}(t) = (\delta^{(1)}_1(t),\ldots,\delta^{(1)}_N(t))$ be drawn, independently for each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho_1$ in the off diagonal and $1$
in the diagonal. Let $\epsilon^{(1)}_i(t)=c_1 \epsilon^{(1)}_i(t-1) + c_2 \epsilon^{(1)}_i(t-2)+\delta^{(1)}_i(t)$. The second process was simple white noise.
Let $\epsilon^{(2)}(t) = (\epsilon^{(2)}_1(t),\ldots,\epsilon^{(2)}_N(t))$ be drawn, independently for each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho_2$ in the off diagonal and $1$
in the diagonal. The noise used was $\epsilon(t)=\epsilon^{(1)}(t)+\epsilon^{(2)}(t)$.

\section{Generation of noise for example 3}\label{sec:noise3}

Noise for example 3 was again the sum of two processes. 
The first process was an
AR(2) process. Let $\delta^{(1)}(t) = (\delta^{(1)}_1(t),\ldots,\delta^{(1)}_N(t))$ be drawn, independently for each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho^{(1)}$ in the off diagonal and $1$
in the diagonal. Let $\epsilon^{(1)}_i(t)=c_1^{(1)} \epsilon^{(1)}_i(t-1) + c_2^{(1)} \epsilon^{(1)}_i(t-2)+\delta^{(1)}_i(t)$. The second process was
another AR(2) process with different parameters. 
Let $\delta^{(2)}(t) = (\delta^{(2)}_1(t),\ldots,\delta^{(2)}_N(t))$ be drawn, independently for each time, $t$, from a multivariate normal distribution with mean $(0,\ldots,0)$
and covariance matrix consisting of entries $\rho^{(2)}$ in the off diagonal and $1$
in the diagonal. Let $\epsilon^{(2)}_i(t)=c_1^{(2)} \epsilon^{(2)}_i(t-1) + c_2^{(2)} \epsilon^{(2)}_i(t-2)+\delta^{(2)}_i(t)$.
The noise used was $\epsilon(t)=\epsilon^{(1)}(t)+\epsilon^{(2)}(t)$.

\bibliographystyle{plainnat}
\bibliography{biblio.bib}

\end{document}

